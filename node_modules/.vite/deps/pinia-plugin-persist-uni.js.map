{
  "version": 3,
  "sources": ["../../pinia-plugin-persist-uni/dist/pinia-persist-uni.es.js"],
  "sourcesContent": ["var _a, _b;\r\nconst isH5 = typeof uni !== \"undefined\" ? [\"web\", \"h5\", void 0].includes((_b = (_a = uni == null ? void 0 : uni.getSystemInfoSync()) == null ? void 0 : _a.uniPlatform) == null ? void 0 : _b.toLocaleLowerCase()) : true;\r\nconst updateStorage = (strategy, store, options) => {\r\n  const storage = strategy.storage;\r\n  const storeKey = strategy.key || store.$id;\r\n  const isCustomStorage = isH5 || (options == null ? void 0 : options.enforceCustomStorage);\r\n  if (strategy.paths) {\r\n    const partialState = strategy.paths.reduce((finalObj, key) => {\r\n      finalObj[key] = store.$state[key];\r\n      return finalObj;\r\n    }, {});\r\n    if (isCustomStorage && storage) {\r\n      storage.setItem(storeKey, JSON.stringify(partialState));\r\n    } else {\r\n      uni.setStorage({ key: storeKey, data: JSON.stringify(partialState) });\r\n    }\r\n  } else if (isCustomStorage && storage) {\r\n    storage.setItem(storeKey, JSON.stringify(store.$state));\r\n  } else {\r\n    uni.setStorage({ key: storeKey, data: JSON.stringify(store.$state) });\r\n  }\r\n};\r\nvar index = ({ options, store }) => {\r\n  var _a2, _b2, _c, _d, _e, _f;\r\n  if ((_a2 = options.persist) == null ? void 0 : _a2.enabled) {\r\n    const defaultStrat = [\r\n      {\r\n        key: store.$id,\r\n        storage: ((_b2 = options.persist) == null ? void 0 : _b2.H5Storage) || (window == null ? void 0 : window.sessionStorage)\r\n      }\r\n    ];\r\n    const strategies = ((_d = (_c = options.persist) == null ? void 0 : _c.strategies) == null ? void 0 : _d.length) ? (_e = options.persist) == null ? void 0 : _e.strategies : defaultStrat;\r\n    strategies.forEach((strategy) => {\r\n      var _a3, _b3;\r\n      const storage = strategy.storage || ((_a3 = options.persist) == null ? void 0 : _a3.H5Storage) || (window == null ? void 0 : window.sessionStorage);\r\n      const storeKey = strategy.key || store.$id;\r\n      let storageResult;\r\n      if (isH5 || ((_b3 = options.persist) == null ? void 0 : _b3.enforceCustomStorage)) {\r\n        storageResult = storage.getItem(storeKey);\r\n      } else {\r\n        storageResult = uni.getStorageSync(storeKey);\r\n      }\r\n      if (storageResult) {\r\n        store.$patch(JSON.parse(storageResult));\r\n        updateStorage(strategy, store, options.persist);\r\n      }\r\n    });\r\n    store.$subscribe(() => {\r\n      strategies.forEach((strategy) => {\r\n        updateStorage(strategy, store, options.persist);\r\n      });\r\n    }, { detached: ((_f = options.persist) == null ? void 0 : _f.detached) ? true : false });\r\n  }\r\n};\r\nexport { index as default };\r\n"],
  "mappings": ";AAAA,IAAI;AAAJ,IAAQ;AACR,IAAM,OAAO,OAAO,QAAQ,cAAc,CAAC,OAAO,MAAM,MAAM,EAAE,UAAU,MAAM,KAAK,OAAO,OAAO,SAAS,IAAI,kBAAkB,MAAM,OAAO,SAAS,GAAG,gBAAgB,OAAO,SAAS,GAAG,kBAAkB,CAAC,IAAI;AACrN,IAAM,gBAAgB,CAAC,UAAU,OAAO,YAAY;AAClD,QAAM,UAAU,SAAS;AACzB,QAAM,WAAW,SAAS,OAAO,MAAM;AACvC,QAAM,kBAAkB,SAAS,WAAW,OAAO,SAAS,QAAQ;AACpE,MAAI,SAAS,OAAO;AAClB,UAAM,eAAe,SAAS,MAAM,OAAO,CAAC,UAAU,QAAQ;AAC5D,eAAS,GAAG,IAAI,MAAM,OAAO,GAAG;AAChC,aAAO;AAAA,IACT,GAAG,CAAC,CAAC;AACL,QAAI,mBAAmB,SAAS;AAC9B,cAAQ,QAAQ,UAAU,KAAK,UAAU,YAAY,CAAC;AAAA,IACxD,OAAO;AACL,UAAI,WAAW,EAAE,KAAK,UAAU,MAAM,KAAK,UAAU,YAAY,EAAE,CAAC;AAAA,IACtE;AAAA,EACF,WAAW,mBAAmB,SAAS;AACrC,YAAQ,QAAQ,UAAU,KAAK,UAAU,MAAM,MAAM,CAAC;AAAA,EACxD,OAAO;AACL,QAAI,WAAW,EAAE,KAAK,UAAU,MAAM,KAAK,UAAU,MAAM,MAAM,EAAE,CAAC;AAAA,EACtE;AACF;AACA,IAAI,QAAQ,CAAC,EAAE,SAAS,MAAM,MAAM;AAClC,MAAI,KAAK,KAAK,IAAI,IAAI,IAAI;AAC1B,OAAK,MAAM,QAAQ,YAAY,OAAO,SAAS,IAAI,SAAS;AAC1D,UAAM,eAAe;AAAA,MACnB;AAAA,QACE,KAAK,MAAM;AAAA,QACX,WAAW,MAAM,QAAQ,YAAY,OAAO,SAAS,IAAI,eAAe,UAAU,OAAO,SAAS,OAAO;AAAA,MAC3G;AAAA,IACF;AACA,UAAM,eAAe,MAAM,KAAK,QAAQ,YAAY,OAAO,SAAS,GAAG,eAAe,OAAO,SAAS,GAAG,WAAW,KAAK,QAAQ,YAAY,OAAO,SAAS,GAAG,aAAa;AAC7K,eAAW,QAAQ,CAAC,aAAa;AAC/B,UAAI,KAAK;AACT,YAAM,UAAU,SAAS,aAAa,MAAM,QAAQ,YAAY,OAAO,SAAS,IAAI,eAAe,UAAU,OAAO,SAAS,OAAO;AACpI,YAAM,WAAW,SAAS,OAAO,MAAM;AACvC,UAAI;AACJ,UAAI,UAAU,MAAM,QAAQ,YAAY,OAAO,SAAS,IAAI,uBAAuB;AACjF,wBAAgB,QAAQ,QAAQ,QAAQ;AAAA,MAC1C,OAAO;AACL,wBAAgB,IAAI,eAAe,QAAQ;AAAA,MAC7C;AACA,UAAI,eAAe;AACjB,cAAM,OAAO,KAAK,MAAM,aAAa,CAAC;AACtC,sBAAc,UAAU,OAAO,QAAQ,OAAO;AAAA,MAChD;AAAA,IACF,CAAC;AACD,UAAM,WAAW,MAAM;AACrB,iBAAW,QAAQ,CAAC,aAAa;AAC/B,sBAAc,UAAU,OAAO,QAAQ,OAAO;AAAA,MAChD,CAAC;AAAA,IACH,GAAG,EAAE,YAAY,KAAK,QAAQ,YAAY,OAAO,SAAS,GAAG,YAAY,OAAO,MAAM,CAAC;AAAA,EACzF;AACF;",
  "names": []
}
